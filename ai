import com.truist.cps.kafka.config.KafkaSdkProperties;
import org.springframework.util.backoff.BackOff;
import org.springframework.util.backoff.FixedBackOff;

public final class SdkBackOffFactory {

    private SdkBackOffFactory() {}

    public static BackOff buildBackOff(KafkaSdkProperties props) {
        KafkaSdkProperties.Retry retry = props.getRetry();

        // Retry disabled â†’ no retries
        if (retry == null || !retry.isEnabled()) {
            return new FixedBackOff(0L, 0L);
        }

        long backoffMs = retry.getBackoffMs() > 0
                ? retry.getBackoffMs()
                : 1000L;

        int maxAttempts = retry.getMaxAttempts() > 0
                ? retry.getMaxAttempts()
                : 1;

        // Spring expects number of *retries*, not attempts
        long maxRetries = Math.max(0, maxAttempts - 1);

        return new FixedBackOff(backoffMs, maxRetries);
    }
}
