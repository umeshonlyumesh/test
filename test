@ExtendWith(MockitoExtension.class)
class EWSResponseForOnboardingTest {

    @Mock private RestClient restClient;
    @Mock private RestClient.RequestBodyUriSpec bodyUriSpec;
    @Mock private RestClient.RequestBodySpec bodySpec;
    @Mock private RestClient.RequestHeadersSpec<?> requestHeadersSpec;
    @Mock private RestClient.ResponseSpec responseSpec;

    @InjectMocks
    private EWSResponseForOnboarding service;

    @Test
    void testRun() throws Exception {
        String mockResponse = "Success";

        // Step 1: post() returns a RequestBodyUriSpec
        when(restClient.post()).thenReturn(bodyUriSpec);

        // Step 2: uri() returns a RequestBodySpec
        when(bodyUriSpec.uri(eq("/company-enrollment/ews-update"))).thenReturn(bodySpec);

        // Step 3: contentType() returns a RequestBodySpec
        when(bodySpec.contentType(eq(MediaType.APPLICATION_JSON))).thenReturn(bodySpec);

        // Step 4: body() returns a RequestHeadersSpec (this fixes your NPE)
        when(bodySpec.body(any())).thenReturn(requestHeadersSpec);

        // Step 5: retrieve() returns ResponseSpec
        when(requestHeadersSpec.retrieve()).thenReturn(responseSpec);

        // Step 6: body(String.class) returns mock response
        when(responseSpec.body(String.class)).thenReturn(mockResponse);

        // Act
        service.run();

        // Assert
        verify(restClient, times(1)).post();
        verify(requestHeadersSpec, times(1)).retrieve();
        verify(responseSpec, times(1)).body(String.class);
    }
}