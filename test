package com.example.demo;

import org.springframework.http.MediaType;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestClient;

import java.util.List;

@Service
public class EWSResponseForOnboarding {

    private final RestClient restClient;

    public EWSResponseForOnboarding(RestClient restClient) {
        this.restClient = restClient;
    }

    /**
     * Calls the AVS endpoint and updates the DB accordingly.
     */
    private void callAVS(List<String> ewsResponseList) {
        String response;
        List<String> ewsRespon = List.of("T00004444");
        try {
            response = restClient.post()
                    .uri("/company-enrollment/ews-update")
                    .contentType(MediaType.APPLICATION_JSON)
                    .body(ewsRespon)
                    .retrieve()
                    .body(String.class);
        } catch (Exception e) {
            throw new RuntimeException("Error connecting to AVS: " + e.getMessage());
        }


    }

    public void run() throws Exception {
        // In real code, this might read a file or DB to get data
        List<String> ewsResponseList = List.of("T00004444");
;
        callAVS(ewsResponseList);
    }

}
