package com.truist.core.integration.util;

import com.truist.core.integration.model.*;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class RequestBuilderTest {

    private final RequestBuilder builder = new RequestBuilder();

    @Test
    void shouldBuildOrchestratedRequestCorrectly() {
        Header header = Header.builder().requestId("REQ10").sourceId("CORE").build();
        FraudRequest payload = FraudRequest.builder().customerId("C007").build();

        OrchestratedRequest request = builder.build("FraudCheck", header, payload);

        assertEquals("FraudCheck", request.getOperationType());
        assertEquals("REQ10", request.getHeader().getRequestId());
        assertEquals("C007", ((FraudRequest) request.getRequestPayload()).getCustomerId());
    }
}
package com.truist.core.integration.orchestration.strategy.impl;

import com.truist.core.integration.model.*;
import com.truist.core.integration.orchestration.OperationExecutor;
import com.truist.core.integration.orchestration.OperationExecutorRegistry;
import org.junit.jupiter.api.*;
import org.mockito.*;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class PostingOrchestratorTest {

    @Mock
    private OperationExecutorRegistry registry;

    @Mock
    private OperationExecutor postingExecutor;

    @InjectMocks
    private PostingOrchestrator orchestrator;

    @BeforeEach
    void setup() {
        MockitoAnnotations.openMocks(this);
        orchestrator = new PostingOrchestrator(registry);
        when(registry.getExecutor("Posting")).thenReturn(postingExecutor);
    }

    @Test
    void shouldExecutePostingSuccessfully() {
        DepositRequest payload = DepositRequest.builder().accountNumber("123").amount(500.0).build();
        OrchestratedRequest request = OrchestratedRequest.builder()
                .operationType("Posting")
                .header(Header.builder().requestId("R3").build())
                .requestPayload(payload)
                .build();

        when(postingExecutor.execute(any())).thenReturn(
                DepositResponse.builder().status("POSTED").confirmationId("CONF1").build()
        );

        CoreIntegrationResponse response = orchestrator.orchestrate(request);
        assertEquals("SUCCESS", response.getStatus());
        assertTrue(response.getPayload() instanceof DepositResponse);
    }
}package com.truist.core.integration.orchestration.strategy.impl;

import com.truist.core.integration.model.*;
import com.truist.core.integration.orchestration.OperationExecutor;
import com.truist.core.integration.orchestration.OperationExecutorRegistry;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.*;
import java.util.*;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class QualificationOrchestratorTest {

    @Mock
    private OperationExecutorRegistry registry;

    @Mock
    private OperationExecutor enrichmentExecutor;
    @Mock
    private OperationExecutor accountValidationExecutor;
    @Mock
    private OperationExecutor balanceEnquiryExecutor;

    @InjectMocks
    private QualificationOrchestrator orchestrator;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        orchestrator = new QualificationOrchestrator(registry);

        when(registry.getExecutor("Enrichment")).thenReturn(enrichmentExecutor);
        when(registry.getExecutor("AccountValidation")).thenReturn(accountValidationExecutor);
        when(registry.getExecutor("BalanceEnquiry")).thenReturn(balanceEnquiryExecutor);
    }

    @Test
    void shouldExecuteAllThreeSdksWhenAllObjectsPresent() {
        // Arrange
        QualificationRequest payload = QualificationRequest.builder()
                .enrichmentInfo(EnrichmentRequest.builder().customerId("C123").build())
                .accountValidationInfo(AccountValidationRequest.builder().accountNumber("111").build())
                .balanceEnquiryInfo(BalanceEnquiryRequest.builder().accountNumber("222").build())
                .build();

        OrchestratedRequest request = OrchestratedRequest.builder()
                .operationType("Qualification")
                .header(Header.builder().requestId("REQ1").sourceId("CORE").build())
                .requestPayload(payload)
                .build();

        when(enrichmentExecutor.execute(any())).thenReturn(Map.of("enrichment", "OK"));
        when(accountValidationExecutor.execute(any())).thenReturn(Map.of("accountValidation", "OK"));
        when(balanceEnquiryExecutor.execute(any())).thenReturn(Map.of("balance", "OK"));

        // Act
        CoreIntegrationResponse response = orchestrator.orchestrate(request);

        // Assert
        assertNotNull(response);
        assertEquals("SUCCESS", response.getStatus());
        assertTrue(response.getPayload() instanceof QualificationCombinedResponse);
        QualificationCombinedResponse combined = (QualificationCombinedResponse) response.getPayload();
        assertEquals(3, combined.getResponses().size());
    }

    @Test
    void shouldHandleMissingSdkGracefully() {
        // Arrange
        when(registry.getExecutor("Enrichment")).thenReturn(null);
        QualificationRequest payload = QualificationRequest.builder()
                .enrichmentInfo(EnrichmentRequest.builder().customerId("C123").build())
                .build();

        OrchestratedRequest request = OrchestratedRequest.builder()
                .operationType("Qualification")
                .header(Header.builder().requestId("REQ2").build())
                .requestPayload(payload)
                .build();

        // Act
        CoreIntegrationResponse response = orchestrator.orchestrate(request);

        // Assert
        assertEquals("SUCCESS", response.getStatus());
        QualificationCombinedResponse combined = (QualificationCombinedResponse) response.getPayload();
        assertTrue(combined.getResponses().containsKey("package com.truist.core.integration.orchestration.strategy.impl;

import com.truist.core.integration.model.*;
import com.truist.core.integration.orchestration.OperationExecutor;
import com.truist.core.integration.orchestration.OperationExecutorRegistry;
import org.junit.jupiter.api.*;
import org.mockito.*;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class FraudOrchestratorTest {

    @Mock
    private OperationExecutorRegistry registry;

    @Mock
    private OperationExecutor fraudExecutor;

    @InjectMocks
    private FraudOrchestrator orchestrator;

    @BeforeEach
    void init() {
        MockitoAnnotations.openMocks(this);
        orchestrator = new FraudOrchestrator(registry);
        when(registry.getExecutor("FraudCheck")).thenReturn(fraudExecutor);
    }

    @Test
    void shouldInvokeFraudSdkSuccessfully() {
        FraudRequest payload = FraudRequest.builder().customerId("C101").build();
        OrchestratedRequest request = OrchestratedRequest.builder()
                .operationType("FraudCheck")
                .header(Header.builder().requestId("R1").build())
                .requestPayload(payload)
                .build();

        when(fraudExecutor.execute(any())).thenReturn(FraudResponse.builder()
                .customerId("C101").fraudScore(5).riskLevel("LOW").build());

        CoreIntegrationResponse response = orchestrator.orchestrate(request);

        assertNotNull(response);
        assertEquals("SUCCESS", response.getStatus());
        assertTrue(response.getPayload() instanceof FraudResponse);
    }

    @Test
    void shouldThrowWhenSdkNotFound() {
        when(registry.getExecutor("FraudCheck")).thenReturn(null);

        OrchestratedRequest req = OrchestratedRequest.builder()
                .operationType("FraudCheck")
                .header(Header.builder().requestId("R2").build())
                .requestPayload(FraudRequest.builder().customerId("C404").build())
                .build();

        assertThrows(IllegalArgumentException.class, () -> orchestrator.orchestrate(req));
    }
}



b

 
	 


