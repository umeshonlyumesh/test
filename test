package com.example.validation;

import org.apache.commons.lang3.StringUtils;
import java.util.List;

public class PaymentInfoValidation {

    private static final List<String> VALID_ACCOUNT_TYPES = List.of("SAV", "CHK");
    private static final List<String> VALID_BANK_ID_TYPES = List.of("ABA", "BIC");

    public static void validate(PaymentInfo info, String side) {
        if (info == null) {
            throw new ValidationException("PaymentInfo cannot be null");
        }

        if (StringUtils.isBlank(side)) {
            throw new ValidationException("Side cannot be null or empty");
        }

        switch (side.toUpperCase()) {
            case "CREDIT" -> validateCredit(info);
            case "DEBIT" -> validateDebit(info);
            case "BOTH" -> {
                validateCredit(info);
                validateDebit(info);
            }
            default -> throw new ValidationException("Invalid side value. Allowed: CREDIT, DEBIT, BOTH");
        }
    }

    private static void validateCredit(PaymentInfo info) {
        if (StringUtils.isBlank(info.getCreditAccountNumber())) {
            throw new ValidationException("Credit account number cannot be null or empty");
        }

        if (!VALID_ACCOUNT_TYPES.contains(StringUtils.upperCase(info.getCreditAccountNumberType()))) {
            throw new ValidationException("Invalid credit account number type. Allowed: SAV, CHK");
        }

        if (!VALID_BANK_ID_TYPES.contains(StringUtils.upperCase(info.getCreditBankIdType()))) {
            throw new ValidationException("Invalid credit bank id type. Allowed: ABA, BIC");
        }
    }

    private static void validateDebit(PaymentInfo info) {
        if (StringUtils.isBlank(info.getDebitAccountNumber())) {
            throw new ValidationException("Debit account number cannot be null or empty");
        }

        if (!VALID_ACCOUNT_TYPES.contains(StringUtils.upperCase(info.getDebitAccountNumberType()))) {
            throw new ValidationException("Invalid debit account number type. Allowed: SAV, CHK");
        }

        if (!VALID_BANK_ID_TYPES.contains(StringUtils.upperCase(info.getDebitBankIdType()))) {
            throw new ValidationException("Invalid debit bank id type. Allowed: ABA, BIC");
        }
    }
}
