package com.truist.core.pez.validation;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

/**
 * SonarQube-clean unit tests for {@link CommonValidation}.
 */
class CommonValidationTest {

    private PaymentInfo paymentInfo;
    private Header header;

    @BeforeEach
    void setUp() {
        paymentInfo = mock(PaymentInfo.class);
        header = mock(Header.class);

        when(paymentInfo.getUetr()).thenReturn("UETR-123");
        when(paymentInfo.getTransactionId()).thenReturn("TXN-001");
    }

    @Test
    void shouldThrowWhenPaymentInfoIsNull() {
        ValidationException ex = assertThrows(
                ValidationException.class,
                () -> CommonValidation.validateUtrAndTransactionId(null, header)
        );

        assertTrue(ex.getMessage().contains("PAYMENT_INFO_ERROR"));
    }

    @Test
    void shouldThrowWhenUetrIsEmpty() {
        when(paymentInfo.getUetr()).thenReturn("");

        ValidationException ex = assertThrows(
                ValidationException.class,
                () -> CommonValidation.validateUtrAndTransactionId(paymentInfo, header)
        );

        assertTrue(ex.getMessage().contains("UETR_ERROR"));
    }

    @Test
    void shouldThrowWhenTransactionIdIsEmpty() {
        when(paymentInfo.getTransactionId()).thenReturn("");

        ValidationException ex = assertThrows(
                ValidationException.class,
                () -> CommonValidation.validateUtrAndTransactionId(paymentInfo, header)
        );

        assertTrue(ex.getMessage().contains("TRANSACTION_ID_ERROR"));
    }

    @Test
    void shouldPassWhenAllValuesValid() {
        assertDoesNotThrow(() ->
                CommonValidation.validateUtrAndTransactionId(paymentInfo, header)
        );
    }
}