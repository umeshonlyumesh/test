@ExtendWith(MockitoExtension.class)
class EWSResponseForOnboardingTest {

    @Mock RestClient restClient;
    @Mock RestClient.RequestBodyUriSpec bodyUriSpec;
    @Mock RestClient.RequestBodySpec bodySpec;       // ðŸ‘ˆ important
    @Mock RestClient.RequestHeadersSpec<?> headersSpec;
    @Mock RestClient.ResponseSpec responseSpec;

    @InjectMocks EWSResponseForOnboarding service;

    @Test
    void testRun() throws Exception {
        String mockResponse = "Success";

        // Step 1: POST
        when(restClient.post()).thenReturn(bodyUriSpec);

        // Step 2: URI
        when(bodyUriSpec.uri(eq("/company-enrollment/ews-update"))).thenReturn(bodySpec);
        when(bodyUriSpec.uri(eq("/company-enrollment/ews-update"), any(Object[].class)))
                .thenReturn(bodySpec);

        // Step 3: contentType()
        when(bodySpec.contentType(eq(MediaType.APPLICATION_JSON))).thenReturn(bodySpec);

        // âœ… Step 4: body() MUST return RequestBodySpec
        when(bodySpec.body(any())).thenReturn(bodySpec);

        // âœ… Step 5: retrieve()
        when(bodySpec.retrieve()).thenReturn(responseSpec);

        // âœ… Step 6: final body(String.class)
        when(responseSpec.body(String.class)).thenReturn(mockResponse);

        // Act
        service.run();

        // Assert
        verify(restClient, times(1)).post();
        verify(bodySpec, times(1)).retrieve();
        verify(responseSpec, times(1)).body(String.class);
    }
}