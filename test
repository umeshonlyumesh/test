package com.truist.kafka.config;

import com.truist.kafka.admin.KafkaTopicManager;
import com.truist.kafka.consumer.KafkaListenerInitializer;
import com.truist.kafka.producer.KafkaProducerClient;
import io.micrometer.core.instrument.simple.SimpleMeterRegistry;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.runner.ApplicationContextRunner;

import static org.assertj.core.api.Assertions.assertThat;

class KafkaSdkAutoConfigurationTest {

    private final ApplicationContextRunner runner = new ApplicationContextRunner()
            .withUserConfiguration(KafkaSdkAutoConfiguration.class)
            .withBean(SimpleMeterRegistry.class)
            .withPropertyValues("kafka.sdk.bootstrap-servers=localhost:9092");

    @Test
    void shouldLoadAllKafkaBeans() {
        runner.run(ctx -> {
            assertThat(ctx).hasSingleBean(KafkaSdkProperties.class);
            assertThat(ctx).hasSingleBean(KafkaTopicManager.class);
            assertThat(ctx).hasSingleBean(KafkaProducerClient.class);
            assertThat(ctx).hasSingleBean(KafkaListenerInitializer.class);
        });
    }
}
