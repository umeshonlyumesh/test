import java.time.*;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import java.util.List;

public class DateFormatNormalizer {

    // Supported patterns
    private static final List<String> SUPPORTED_PATTERNS = List.of(
        "yyyy-MM-dd HH:mm:ss.SSS",
        "M/d/yyyy",
        "yyyy-MM-dd'T'HH:mm:ss.SSSXXX",
        "yyyy-MM-dd'T'HH:mm:ss.SSSX",
        "yyyy-MM-dd HH:mm:ss.SSS"
    );

    // Target format -> yyyy-MM-dd'T'HH:mm:ss.SSSZ
    private static final DateTimeFormatter TARGET_FORMAT =
            DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm:ss.SSSZ");

    public static String normalize(String input) {
        if (input == null || input.isBlank()) {
            return "";
        }

        input = input.trim();

        for (String pattern : SUPPORTED_PATTERNS) {
            try {
                DateTimeFormatter formatter = DateTimeFormatter.ofPattern(pattern)
                        .withZone(ZoneId.systemDefault());

                ZonedDateTime zdt;

                if (pattern.contains("'T'") && pattern.contains("X")) {
                    // Pattern includes timezone info
                    zdt = ZonedDateTime.parse(input, formatter);
                } else if (pattern.contains("HH")) {
                    // Datetime without zone → assume system zone
                    LocalDateTime ldt = LocalDateTime.parse(input, formatter);
                    zdt = ldt.atZone(ZoneId.systemDefault());
                } else {
                    // Simple date only → assume start of day
                    LocalDate ld = LocalDate.parse(input, formatter);
                    zdt = ld.atStartOfDay(ZoneId.systemDefault());
                }

                return zdt.format(TARGET_FORMAT);
            } catch (DateTimeParseException ignored) {
                // Try next pattern
            }
        }

        // No matching format
        return "";
    }

    // ✅ Quick Test
    public static void main(String[] args) {
        List<String> samples = List.of(
            "2025-03-03 10:22:15.123",
            "7/19/2019",
            "2025-03-03T10:22:15.123-04:00",
            "2025-03-03T10:22:15.123Z",
            "2025-11-07 15:26:21.211",
            "invalid-date"
        );

        for (String sample : samples) {
            System.out.printf("%-35s -> %s%n", sample, normalize(sample));
        }
    }
}