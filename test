public class TokenizationHelper {

    public static void detokenizeFields(FraudRequest request, 
                                        TokenizationUtil tokenizationUtil, 
                                        Set<String> fieldIds) {
        List<Parameter> params = request.getParameters();
        List<String> tokens = params.stream()
            .filter(p -> fieldIds.contains(p.getFieldId()))
            .map(Parameter::getFieldValue)
            .toList();

        if (tokens.isEmpty()) return;

        List<String> detokValues = tokenizationUtil.deTokenize(tokens);
        Iterator<String> detokIt = detokValues.iterator();

        for (int i = 0; i < params.size(); i++) {
            var p = params.get(i);
            if (fieldIds.contains(p.getFieldId()) && detokIt.hasNext()) {
                params.set(i, new Parameter(p.getFieldId(), detokIt.next()));
            }
        }
    }
}